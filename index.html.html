<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel AI Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22TravelAI%22,%22short_name%22:%22TravelAI%22,%22display%22:%22standalone%22,%22background_color%22:%22#007AFF%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/2881/2881031.png%22,%22sizes%22:%22512x512%22}]}">
    
    <style>
        :root { --primary: #007AFF; --secondary: #34C759; --bg: #ffffff; --text: #000; --panel: #f2f2f7; }
        .dark-mode { --bg: #1c1c1e; --text: #ffffff; --panel: #2c2c2e; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; transition: 0.3s; }
        header { display: flex; justify-content: space-between; padding: 15px; background: var(--panel); align-items: center; font-weight: bold; }
        .tabs { display: flex; background: var(--panel); border-bottom: 1px solid #ccc; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; opacity: 0.5; }
        .tab.active { opacity: 1; border-bottom: 3px solid var(--primary); color: var(--primary); }
        .mode-section { display: none; flex: 1; flex-direction: column; }
        .mode-section.active { display: flex; }
        video { width: 100%; flex: 1; object-fit: cover; background: #000; }
        .chat-area { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 12px; border-radius: 15px; max-width: 80%; font-size: 0.9rem; }
        .user1 { align-self: flex-start; background: var(--primary); color: white; }
        .user2 { align-self: flex-end; background: var(--secondary); color: white; }
        .footer { padding: 15px; background: var(--panel); display: flex; flex-direction: column; gap: 10px; }
        button { padding: 12px; border-radius: 12px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; }
        select { padding: 10px; border-radius: 8px; background: var(--bg); color: var(--text); }
    </style>
</head>
<body>

<header>
    <span>Travel AI üåç</span>
    <button onclick="document.body.classList.toggle('dark-mode')" style="width:auto; padding:5px 10px;">üåì Mode</button>
</header>

<div class="tabs">
    <div class="tab active" onclick="switchTab('photo')">üì∏ Photo</div>
    <div class="tab" onclick="switchTab('conv')">üó£Ô∏è Chat</div>
</div>

<div id="photo" class="mode-section active">
    <video id="video" autoplay playsinline></video>
    <div class="footer">
        <div id="status" style="text-align:center; font-size:0.8rem; margin-bottom:5px;">Ready to scan...</div>
        <button onclick="scanPhoto()">Instant Scan</button>
    </div>
</div>

<div id="conv" class="mode-section">
    <div class="chat-area" id="chat-area"></div>
    <div class="footer">
        <div style="display:flex; gap:10px;">
            <select id="l1" style="flex:1;"><option value="en-US">English</option></select>
            <select id="l2" style="flex:1;"><option value="es-ES">Spanish</option><option value="fr-FR">French</option><option value="hi-IN">Hindi</option></select>
        </div>
        <div style="display:flex; gap:10px;">
            <button onclick="listen(false)">My Voice</button>
            <button onclick="listen(true)" style="background:var(--secondary)">Their Voice</button>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const chatArea = document.getElementById('chat-area');
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

    async function initCam() {
        const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = s;
    }

    function switchTab(m) {
        document.querySelectorAll('.mode-section, .tab').forEach(e => e.classList.remove('active'));
        document.getElementById(m).classList.add('active');
        event.currentTarget.classList.add('active');
        if(m==='photo') initCam();
    }

    async function scanPhoto() {
        const c = document.createElement('canvas');
        c.width = video.videoWidth; c.height = video.videoHeight;
        c.getContext('2d').drawImage(video, 0, 0);
        document.getElementById('status').innerText = "Reading text...";
        const w = await Tesseract.createWorker('eng');
        const { data: { text } } = await w.recognize(c.toDataURL());
        await w.terminate();
        translate(text, document.getElementById('l2').value.split('-')[0], (res) => {
            document.getElementById('status').innerText = res;
            speak(res, document.getElementById('l2').value);
        });
    }

    function listen(isU2) {
        recognition.lang = isU2 ? document.getElementById('l2').value : document.getElementById('l1').value;
        recognition.start();
        recognition.onresult = (e) => {
            const txt = e.results[0][0].transcript;
            addB(txt, isU2 ? 'user2' : 'user1');
            const to = isU2 ? 'en' : document.getElementById('l2').value.split('-')[0];
            translate(txt, to, (res) => {
                addB(res, isU2 ? 'user1' : 'user2');
                speak(res, to);
            });
        };
    }

    async function translate(q, l, cb) {
        const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${l}&dt=t&q=${encodeURI(q)}`);
        const d = await r.json(); cb(d[0][0][0]);
    }

    function speak(t, l) {
        const m = new SpeechSynthesisUtterance(t); m.lang = l;
        window.speechSynthesis.speak(m);
    }

    function addB(t, c) {
        const d = document.createElement('div'); d.className = `bubble ${c}`; d.innerText = t;
        chatArea.appendChild(d); chatArea.scrollTop = chatArea.scrollHeight;
    }

    initCam();
</script>
</body>
</html>