<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel AI Translator</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        :root { --primary: #007AFF; --secondary: #34C759; --bg: #ffffff; --text: #000; --panel: #f2f2f7; }
        .dark-mode { --bg: #1c1c1e; --text: #ffffff; --panel: #2c2c2e; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; transition: 0.3s; overflow: hidden; }
        header { display: flex; justify-content: space-between; padding: 15px; background: var(--panel); align-items: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tabs { display: flex; background: var(--panel); }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; opacity: 0.5; font-weight: bold; }
        .tab.active { opacity: 1; border-bottom: 3px solid var(--primary); color: var(--primary); }
        .mode-section { display: none; flex: 1; flex-direction: column; }
        .mode-section.active { display: flex; }
        video { width: 100%; flex: 1; object-fit: cover; background: #000; }
        .chat-area { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: var(--bg); }
        .bubble { padding: 12px; border-radius: 15px; max-width: 80%; font-size: 0.95rem; line-height: 1.4; }
        .user1 { align-self: flex-start; background: var(--primary); color: white; border-bottom-left-radius: 2px; }
        .user2 { align-self: flex-end; background: var(--secondary); color: white; border-bottom-right-radius: 2px; }
        .footer { padding: 15px; background: var(--panel); display: flex; flex-direction: column; gap: 10px; border-top: 1px solid #ddd; }
        button { padding: 12px; border-radius: 12px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); opacity: 0.8; }
        select { padding: 10px; border-radius: 8px; background: var(--bg); color: var(--text); border: 1px solid #ccc; }
    </style>
</head>
<body>

<header>
    <span>Travel AI üåç</span>
    <button onclick="document.body.classList.toggle('dark-mode')" style="width:auto; padding:5px 12px; font-size: 0.8rem;">üåì Dark Mode</button>
</header>

<div class="tabs">
    <div class="tab active" onclick="switchTab('photo')">üì∏ Photo Scan</div>
    <div class="tab" onclick="switchTab('conv')">üó£Ô∏è Chat Mode</div>
</div>

<div id="photo" class="mode-section active">
    <video id="video" autoplay playsinline></video>
    <div class="footer">
        <div id="status" style="text-align:center; font-size:0.85rem; font-weight: bold;">Ready to scan...</div>
        <button onclick="scanPhoto()">Instant Scan & Translate</button>
    </div>
</div>

<div id="conv" class="mode-section">
    <div class="chat-area" id="chat-area">
        <div class="bubble user1" style="background:#eee; color:#666;">Choose languages and start talking!</div>
    </div>
    <div class="footer">
        <div style="display:flex; gap:10px;">
            <select id="l1" style="flex:1;"><option value="en-US">English</option></select>
            <select id="l2" style="flex:1;">
                <option value="hi-IN">Hindi</option>
                <option value="ur-PK">Urdu</option>
                <option value="ar-SA">Arabic</option>
                <option value="fr-FR">French</option>
                <option value="es-ES">Spanish</option>
            </select>
        </div>
        <div style="display:flex; gap:10px;">
            <button id="btn1" onclick="listen(false)" style="flex:1;">üé§ My Voice</button>
            <button id="btn2" onclick="listen(true)" style="background:var(--secondary); flex:1;">üé§ Their Voice</button>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const chatArea = document.getElementById('chat-area');
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

    async function initCam() {
        try {
            const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            video.srcObject = s;
        } catch(e) { console.log("Camera error"); }
    }

    function switchTab(m) {
        document.querySelectorAll('.mode-section, .tab').forEach(e => e.classList.remove('active'));
        document.getElementById(m).classList.add('active');
        event.currentTarget.classList.add('active');
        if(m==='photo') initCam();
    }

    async function scanPhoto() {
        const c = document.createElement('canvas');
        c.width = video.videoWidth; c.height = video.videoHeight;
        c.getContext('2d').drawImage(video, 0, 0);
        document.getElementById('status').innerText = "AI is reading text...";
        
        const w = await Tesseract.createWorker('eng');
        const { data: { text } } = await w.recognize(c.toDataURL());
        await w.terminate();

        const target = document.getElementById('l2').value.split('-')[0];
        translate(text, target, (res) => {
            document.getElementById('status').innerText = res;
            speak(res, document.getElementById('l2').value);
        });
    }

    function listen(isU2) {
        recognition.lang = isU2 ? document.getElementById('l2').value : document.getElementById('l1').value;
        recognition.start();
        document.getElementById(isU2 ? 'btn2' : 'btn1').innerText = "Listening...";

        recognition.onresult = (e) => {
            const txt = e.results[0][0].transcript;
            addB(txt, isU2 ? 'user2' : 'user1');
            const to = isU2 ? 'en' : document.getElementById('l2').value.split('-')[0];
            translate(txt, to, (res) => {
                addB(res, isU2 ? 'user1' : 'user2');
                speak(res, isU2 ? 'en-US' : document.getElementById('l2').value);
            });
        };
        recognition.onend = () => {
            document.getElementById('btn1').innerText = "üé§ My Voice";
            document.getElementById('btn2').innerText = "üé§ Their Voice";
        };
    }

    async function translate(q, l, cb) {
        if(!q.trim()) return;
        const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${l}&dt=t&q=${encodeURI(q)}`);
        const d = await r.json(); cb(d[0][0][0]);
    }

    function speak(t, l) {
        const m = new SpeechSynthesisUtterance(t); m.lang = l;
        window.speechSynthesis.speak(m);
    }

    function addB(t, c) {
        const d = document.createElement('div'); d.className = `bubble ${c}`; d.innerText = t;
        chatArea.appendChild(d); chatArea.scrollTop = chatArea.scrollHeight;
    }

    initCam();
</script>
</body>
</html>
